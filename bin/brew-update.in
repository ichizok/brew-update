#!/bin/sh
set -eu

readonly HOMEBREW_PREFIX="{{HOMEBREW_PREFIX}}"
readonly BREW="${HOMEBREW_PREFIX}/bin/brew"
readonly BREW_LOGDIR="${HOME}/Library/Logs/Homebrew"
readonly BREW_UPDATE_LOG="${BREW_LOGDIR}/update.log"

mkdir -p "${BREW_LOGDIR}"

cat <<EOT >>"${BREW_UPDATE_LOG}"

#
# $(date)
#

EOT

"${BREW}" update >>"${BREW_UPDATE_LOG}" 2>&1

readonly TERMINAL_NOTIFIER="${HOMEBREW_PREFIX}/bin/terminal-notifier"
readonly APP_ID=com.apple.Terminal

[ -x "${TERMINAL_NOTIFIER}" ] || exit 0

if [ -n "$("${BREW}" outdated --quiet)" ]; then
    "${TERMINAL_NOTIFIER}" -title Homebrew -message "Found outdated formulae" -sender "${APP_ID}"
fi
